#!/bin/bash

# Run interactive Homebrew drift review after Brewfile changes.
# Exits silently when stdin is not a tty (non-interactive apply).

# Brewfile hash (triggers re-run when Brewfile changes):
# {{ include "Brewfile" | sha256sum }}

{{- if eq .chezmoi.os "darwin" "linux" }}
# Source brew shellenv in case brew is not yet on PATH
if ! command -v brew &>/dev/null; then
  for p in /opt/homebrew/bin /home/linuxbrew/.linuxbrew/bin "$HOME/.linuxbrew/bin"; do
    [ -x "$p/brew" ] && eval "$("$p/brew" shellenv)" && break
  done
fi

BREW_REVIEW="$CHEZMOI_SOURCE_DIR/dot_scripts/brew-review"
if command -v brew &>/dev/null && [ -f "$BREW_REVIEW" ]; then
  bash "$BREW_REVIEW" || true
fi
{{ end -}}
