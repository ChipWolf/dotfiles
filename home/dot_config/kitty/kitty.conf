# kitty configuration
# https://sw.kovidgoyal.net/kitty/conf/

# --- Font ---
font_family      FiraCode Nerd Font Mono
bold_font        auto
italic_font      auto
bold_italic_font auto
font_size        13.0

# Slight baseline raise to split the difference between icon and text alignment
modify_font baseline 2

# Nerd Fonts v3.3.0 codepoints mapped explicitly to FiraCode Nerd Font Mono
symbol_map U+e000-U+e00a,U+ea60-U+ebeb,U+e0a0-U+e0c8,U+e0ca,U+e0cc-U+e0d7,U+e200-U+e2a9,U+e300-U+e3e3,U+e5fa-U+e6b7,U+e700-U+e8ef,U+ed00-U+efc1,U+f000-U+f2ff,U+f000-U+f2e0,U+f300-U+f381,U+f400-U+f533,U+f0001-U+f1af0 Symbols Nerd Font Mono

# --- Terminal ---
# Use kitty's keyboard protocol; xterm-256color degrades to modifyOtherKeys
term xterm-kitty

# --- Cursor ---
cursor_shape           block
cursor_blink_interval  0

# --- Scrollback ---
scrollback_lines 10000000

# --- Mouse ---
mouse_hide_wait 3.0

# Unmap accidental link-opens on bare left click; require ctrl+left instead
mouse_map left   click ungrabbed no-op
mouse_map ctrl+left click ungrabbed mouse_handle_click selection link prompt
mouse_map ctrl+left press ungrabbed mouse_selection normal
mouse_map right  press ungrabbed copy_to_clipboard

# --- Selection ---
select_by_word_characters @-./_~?&=%+#
strip_trailing_spaces never
paste_actions quote-urls-at-prompt

# --- Window ---
# No title bar on macOS; use the full content area
hide_window_decorations titlebar-only
window_padding_width    0
window_border_width     0.5pt
window_resize_step_cells 2
window_resize_step_lines 2
visual_window_select_characters 1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ

# Prompt before closing only when a command is running (shell prompts don't count)
confirm_os_window_close -1

# --- Tab bar ---
tab_bar_style       powerline
tab_powerline_style slanted
# Show zoom indicator (Z flag emoji) when in stack layout with multiple windows
tab_title_template  "{fmt.fg.red}{bell_symbol}{activity_symbol}{fmt.fg.tab}{index}:{'Z' if layout_name == 'stack' and num_windows > 1 else ''}{title}"

# --- Bell ---
enable_audio_bell no

# --- Remote control ---
allow_remote_control yes
# kitty appends the pid to this path when multiple instances run:
# socket will be at unix:/tmp/kitty-<pid>
# Use: kitty @ --to unix:/tmp/kitty-$(pgrep -n kitty) <cmd>
listen_on unix:/tmp/kitty

# --- Shell integration ---
shell_integration enabled

# --- Clipboard ---
copy_on_select clipboard

# --- URLs / Hyperlinks ---
detect_urls yes
show_hyperlink_targets yes
allow_hyperlinks yes

# --- Layouts ---
# splits is the working layout; stack is zoom (toggled via zoom_toggle.py)
enabled_layouts splits,stack

# --- Session ---
startup_session default.kitty-session

# --- Key maps: global modifier ---
# kitty_mod is used only as a fallback; primary prefix is ctrl+a (tmux-style)
kitty_mod ctrl+shift

# Disable default kitty_mod+enter (accidental window creation)
map kitty_mod+enter no-op
map cmd+enter       no-op

# --- Key maps: ctrl+a prefix (tmux-style) ---

# Send literal ctrl+a (e.g. readline beginning-of-line) by pressing ctrl+a twice
map ctrl+a>ctrl+a send_text all \x01

# Send literal newline (shift+enter workaround for Claude Code)
map shift+enter send_text all \n

# Windows
map ctrl+a>x close_window
map ctrl+a>] next_window
map ctrl+a>[ previous_window
map ctrl+a>period move_window_forward
map ctrl+a>comma  move_window_backward
map ctrl+a>q      focus_visible_window

# Tabs
map ctrl+a>c launch --cwd=last_reported --type=tab
map ctrl+a>, set_tab_title

# Splits (defined in splits.conf)
include splits.conf

# Zoom toggle (smarter than toggle_layout: skips if only one window)
# defined in splits.conf as: map ctrl+a>z kitten zoom_toggle.py

# Hints (tmux-thumbs-style URL/path/filename selection)
map ctrl+a>space kitten hints --alphabet asdfqwerzxcvjklmiuopghtybn1234567890 --customize-processing custom-hints.py
map f3           kitten hints --program '*'

# Theme picker
map ctrl+a>t kitten themes

# Config
map ctrl+a>e         no-op
map ctrl+a>shift+e   launch --type=tab nvim ~/.config/kitty/kitty.conf
map ctrl+a>shift+r   combine : load_config_file : launch --type=overlay sh -c 'echo "kitty config reloaded."; echo; read -r -p "Press Enter to exit"; echo ""'
map ctrl+a>shift+d   debug_config

# Session save
map ctrl+a>s combine : save_as_session --save-only --use-foreground-process . : launch --type=overlay sh -c 'echo "kitty session saved."; echo; read -r -p "Press Enter to exit"; echo ""'

# Font size
map ctrl+equal       change_font_size all +2.0
map ctrl+plus        change_font_size all +2.0
map ctrl+kp_add      change_font_size all +2.0
map ctrl+minus       change_font_size all -2.0
map ctrl+kp_subtract change_font_size all -2.0
map ctrl+0           change_font_size all 0

# Fullscreen
map f11 toggle_fullscreen

# Close OS window
map ctrl+q close_os_window

# --- Catppuccin Mocha theme ---
# https://github.com/catppuccin/kitty

# Basic colors
foreground              #cdd6f4
background              #1e1e2e
selection_foreground    #1e1e2e
selection_background    #f5e0dc

# Cursor colors
cursor            #f5e0dc
cursor_text_color #1e1e2e

# URL color
url_color #f5e0dc

# Window border colors
active_border_color   #b4befe
inactive_border_color #6c7086
bell_border_color     #f9e2af

# macOS titlebar color
macos_titlebar_color background

# Tab bar colors
active_tab_foreground   #11111b
active_tab_background   #cba6f7
inactive_tab_foreground #cdd6f4
inactive_tab_background #181825
tab_bar_background      #11111b

# Mark colors
mark1_foreground #1e1e2e
mark1_background #b4befe
mark2_foreground #1e1e2e
mark2_background #cba6f7
mark3_foreground #1e1e2e
mark3_background #74c7ec

# 16 terminal colors

# black
color0 #45475a
color8 #585b70

# red
color1 #f38ba8
color9 #f38ba8

# green
color2  #a6e3a1
color10 #a6e3a1

# yellow
color3  #f9e2af
color11 #f9e2af

# blue
color4  #89b4fa
color12 #89b4fa

# magenta
color5  #f5c2e7
color13 #f5c2e7

# cyan
color6  #94e2d5
color14 #94e2d5

# white
color7  #bac2de
color15 #a6adc8

# --- Local overrides ---
include ${USER}.local.conf
